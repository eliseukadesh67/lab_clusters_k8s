<%- include('partials/header') %>

<div class="mt-4">
    <h1>Download de Vídeos</h1>
    <p class="lead text-muted">Cole a URL do YouTube e baixe instantaneamente.</p>

    <div class="card my-4">
        <div class="card-body">
            <h5 class="card-title mb-3"><i class="fas fa-link me-2 text-primary"></i>URL do Vídeo</h5>
            <form action="/downloads" method="POST" class="d-flex gap-2">
                <input type="url" name="url" class="form-control" placeholder="https://www.youtube.com/watch?v=..." required>
                <button type="submit" class="btn btn-success px-4" id="downloadButton">
                    <i class="fas fa-download me-2"></i>Baixar
                </button>
            </form>
        </div>
    </div>

    <% if (error) { %>
        <div class="alert alert-danger" role="alert">
            <i class="fas fa-exclamation-triangle me-2"></i><%= error %>
        </div>
    <% } %>

    <div id="status-message" class="mt-3 text-info" style="display: none;">
        <i class="fas fa-spinner fa-spin me-2"></i>Iniciando o download... Por favor, aguarde.
    </div>
</div>

<%- include('partials/footer') %>

<script>
    document.getElementById('downloadButton').addEventListener('click', function() {
        const urlInput = document.querySelector('input[name="url"]');
        if (urlInput.checkValidity()) { // Verifica se a URL é válida antes de mostrar a mensagem
            document.getElementById('status-message').style.display = 'block';
            this.disabled = true; // Desabilita o botão para evitar cliques múltiplos
            this.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Processando...';
        }
    });

    <% if (error) { %>
        document.getElementById('status-message').style.display = 'none'; // Esconde a mensagem de "processando" se já tem erro
    <% } %>
</script>