apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-grpc-overview
  namespace: observability
  labels:
    grafana_dashboard: "1"
data:
  grpc-overview.json: |
    {"title":"gRPC Services Overview","uid":"grpc-overview-pspd","timezone":"browser","schemaVersion":39,"version":1,"refresh":"30s","templating":{"list":[{"name":"datasource","type":"datasource","query":"prometheus","hide":0,"label":"Datasource","Current":{},"refresh":1}]},"panels":[{"type":"timeseries","title":"gRPC Requests per second (by service/method)","gridPos":{"x":0,"y":0,"w":12,"h":8},"datasource":{"type":"prometheus","uid":"${datasource}"},"targets":[{"expr":"sum by (service, grpc_method) (rate(grpc_server_requests_total[5m]))","legendFormat":"{{service}} {{grpc_method}}"}]},{"type":"timeseries","title":"gRPC Error rate % (non-OK)","gridPos":{"x":12,"y":0,"w":12,"h":8},"datasource":{"type":"prometheus","uid":"${datasource}"},"fieldConfig":{"defaults":{"unit":"percent"},"overrides":[]},"targets":[{"expr":"100 * (sum by (service) (rate(grpc_server_requests_total{grpc_code!~\"OK\"}[5m])) / sum by (service) (rate(grpc_server_requests_total[5m])))","legendFormat":"{{service}}"}]},{"type":"timeseries","title":"gRPC P95 latency (s) by method","gridPos":{"x":0,"y":8,"w":12,"h":8},"datasource":{"type":"prometheus","uid":"${datasource}"},"targets":[{"expr":"histogram_quantile(0.95, sum by (le, service, grpc_method) (rate(grpc_server_handling_seconds_bucket[5m])))","legendFormat":"{{service}} {{grpc_method}}"}]},{"type":"bargauge","title":"gRPC codes (5m) by method","gridPos":{"x":12,"y":8,"w":12,"h":8},"datasource":{"type":"prometheus","uid":"${datasource}"},"targets":[{"expr":"sum by (grpc_method, grpc_code) (rate(grpc_server_requests_total[5m]))","legendFormat":"{{grpc_method}} {{grpc_code}}"}]}]}